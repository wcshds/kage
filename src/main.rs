use kage::{
    font::{ming::Ming, stroke_adjustment::StrokeAdjustmentTrait},
    line::Line,
    polygons::Polygons,
};

fn init(use_curve: bool) -> Ming {
    Ming {
        k_rate: 100,
        k_min_width_horizontal: 2.0,
        k_min_width_triangle: 2.0,
        k_min_width_vertical: 6.0,
        k_width: 5.0,
        k_square_terminal: 3.0,
        k_l2rdfatten: 1.1,
        k_mage: 10.0,
        k_use_curve: use_curve,
        k_adjust_kakato_l: vec![14.0, 9.0, 5.0, 2.0, 0.0],
        k_adjust_kakato_r: vec![8.0, 6.0, 4.0, 2.0],
        k_adjust_kakato_range_x: 20.0,
        k_adjust_kakato_range_y: vec![1.0, 19.0, 24.0, 30.0],
        k_adjust_kakato_step: 3.0,
        k_adjust_uroko_x: vec![24.0, 20.0, 16.0, 12.0],
        k_adjust_uroko_y: vec![12.0, 11.0, 9.0, 8.0],
        k_adjust_uroko_length: vec![22.0, 36.0, 50.0],
        k_adjust_uroko_length_step: 3.0,
        k_adjust_uroko_line: vec![22.0, 26.0, 30.0],
        k_adjust_uroko2_step: 3.0,
        k_adjust_uroko2_length: 40.0,
        k_adjust_tate_step: 4.0,
        k_adjust_mage_step: 5.0,
    }
}

fn main() {
    let glyph_data = "6:32:7:128:28:145:28:136:54:131:68$2:7:8:131:67:193:88:165:150$2:7:8:110:173:150:187:168:144$2:7:8:127:176:102:176:106:129$2:32:7:105:133:111:97:120:89$2:7:8:117:90:137:85:129:138$2:32:7:130:133:120:176:97:172$2:7:8:108:174:81:176:80:153$2:32:7:80:158:83:117:142:135$2:7:8:85:141:118:108:178:172$2:7:8:162:188:170:180:177:168$2:7:8:43:42:34:119:67:165$2:7:8:73:26:80:104:41:176$2:7:8:25:160:29:174:43:173$2:7:8:84:51:31:106:23:161$2:7:8:36:176:24:165:23:157$2:7:8:77:60:108:29:132:28$2:7:8:137:23:153:33:161:53$2:7:8:157:12:174:21:182:39";
    // let glyph_data = "1:0:2:15.75:27:63.875:27$1:22:23:63.875:27:63.875:68$1:2:2:28:68:63.875:68$1:12:13:28:68:23.625:107$1:2:2:23.625:107:64.75:107$2:22:4:64.75:107:63.875:155:50.75:182$1:0:0:77.259:24.86:188.148:24.86$1:32:4:162.82150000000001:24.86:162.82150000000001:92.54$1:12:13:95.7405:45.540000000000006:95.7405:72.8$1:2:2:95.7405:45.540000000000006:134.0725:45.540000000000006$1:22:23:134.0725:45.540000000000006:134.0725:72.8$1:2:2:95.7405:72.8:134.0725:72.8$1:0:0:77.259:106.33:188.148:106.33$1:32:4:162.82150000000001:106.33:162.82150000000001:183.37$1:12:13:96.14750000000001:128.27:96.14750000000001:154.73$1:2:2:96.14750000000001:128.27:133.7025:128.27$1:22:23:133.7025:128.27:133.7025:154.73$1:2:2:96.14750000000001:154.73:133.7025:154.73";
    // let glyph_data = "6:32:7:128:28:145:28:136:54:131:68";
    // let glyph_data = "1:0:0:15:55:67:55$1:0:4:41:15:41:181$2:0:7:16:122:43:107:67:91$1:12:13:77:23:77:83$1:2:0:77:23:121:23$1:32:32:97:23:97:42$1:2:2:77:42:114:42$1:22:23:114:42:114:63$1:2:2:77:63:114:63$1:32:32:97:63:97:83$1:2:0:77:83:122:83$2:0:7:140:16:133:45:121:66$1:0:0:135:33:187:33$1:0:0:138:48:178:48$1:12:13:135:61:135:82$1:2:2:135:61:175:61$1:22:23:175:61:175:82$1:32:32:148:61:148:82$1:32:32:162:61:162:82$1:2:2:135:82:175:82$1:12:13:93:99:93:148$1:2:2:93:99:164:99$1:22:23:164:99:164:148$1:2:2:93:115:164:115$1:2:2:93:131:164:131$1:2:2:93:148:164:148$2:32:7:116:149:111:180:55:188$3:32:5:138:150:138:180:182:180";

    let line_arr: Vec<_> = glyph_data
        .split("$")
        .map(|field_data| Line::new(field_data))
        .collect();
    let stroke_line_type_arr: Vec<_> = line_arr
        .iter()
        .filter_map(|each| match each {
            Line::StrokeLine(line_type) => Some(line_type),
            _ => None,
        })
        .collect();

    let ming = init(false);

    let result = ming.adjust_strokes(&stroke_line_type_arr);
    let mut polygons = Polygons::new();
    for (&stroke_line_type, adjusted_stroke) in result {
        ming.df_draw_font(
            &mut polygons,
            Line::StrokeLine(stroke_line_type),
            adjusted_stroke,
        );
    }

    println!("{}", polygons.generate_svg(false));
}
